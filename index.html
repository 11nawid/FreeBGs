<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FreeBGs - All Media</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="https://11nawid.github.io/FreeBGs/favicon.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .loader {
      border: 4px solid #ccc;
      border-top: 4px solid #3490dc;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      animation: spin 1s linear infinite;
      margin: auto;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .media-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }
    .media-preview {
      height: 200px;
      background-color: #2d3748;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .media-preview img,
    .media-preview video {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    .filename, .url-input {
      word-break: break-word;
      overflow-wrap: break-word;
    }
    .url-input {
      white-space: nowrap;
      overflow-x: auto;
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen py-10 px-4 sm:px-8">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-center">ðŸŽ¬ FreeBGs - All Media</h1>
    <div id="media" class="media-container"><div class="loader"></div></div>
  </div>

  <script>
    const GITHUB_USERNAME = "11nawid";
    const REPO_NAME = "FreeBGs";
    const BASE_PATH = "media";
    const API_ROOT = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/`;
    const PUBLIC_URL = `https://${GITHUB_USERNAME}.github.io/${REPO_NAME}/`;

    const IMAGE_EXTS = ['.jpg', '.jpeg', '.png', '.webp'];
    const GIF_EXTS = ['.gif'];
    const VIDEO_EXTS = ['.mp4', '.webm', '.mov'];

    const mediaContainer = document.getElementById("media");

    async function fetchFilesRecursively(path = BASE_PATH) {
      const res = await fetch(`${API_ROOT}${path}`);
      const data = await res.json();
      if (!Array.isArray(data)) return [];

      let allFiles = [];

      for (const item of data) {
        if (item.type === "file") {
          allFiles.push(item.path);
        } else if (item.type === "dir") {
          const nested = await fetchFilesRecursively(item.path);
          allFiles = allFiles.concat(nested);
        }
      }

      return allFiles;
    }

    function getFileType(fileName) {
      const name = fileName.toLowerCase();
      if (VIDEO_EXTS.some(ext => name.endsWith(ext))) return "video";
      if (GIF_EXTS.some(ext => name.endsWith(ext))) return "gif";
      if (IMAGE_EXTS.some(ext => name.endsWith(ext))) return "image";
      return "unknown";
    }

    function createMediaCard(filePath) {
      const fileName = filePath.split("/").pop();
      const fileURL = `${PUBLIC_URL}${filePath}`;
      const type = getFileType(fileName);

      if (type === "unknown") return "";

      let mediaHTML = "";
      if (type === "video") {
        mediaHTML = `<video src="${fileURL}" controls loop muted playsinline class="w-full h-full object-contain"></video>`;
      } else {
        mediaHTML = `<img src="${fileURL}" alt="${fileName}" loading="lazy" class="w-full h-full object-contain">`;
      }

      return `
        <div class="bg-gray-800 rounded-lg shadow p-4">
          <div class="media-preview">${mediaHTML}</div>
          <h3 class="text-lg font-semibold mt-3 filename">${fileName}</h3>
          <input class="w-full text-sm bg-gray-700 text-gray-200 px-3 py-1 rounded border border-gray-600 url-input mt-2" value="${fileURL}" readonly onclick="this.select()">
          <button onclick="copyURL(this)" class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-1 rounded text-sm">ðŸ“‹ Copy URL</button>
        </div>
      `;
    }

    async function loadMedia() {
      mediaContainer.innerHTML = "<div class='loader'></div>";

      try {
        const allFiles = await fetchFilesRecursively();

        const cards = allFiles
          .map(path => createMediaCard(path))
          .filter(html => html.trim() !== "");

        if (cards.length === 0) {
          mediaContainer.innerHTML = `<p class="text-center text-yellow-400">No media files found.</p>`;
        } else {
          mediaContainer.innerHTML = cards.join("");
        }
      } catch (err) {
        mediaContainer.innerHTML = `<p class="text-center text-red-500">Failed to load media.</p>`;
        console.error("Error fetching media:", err);
      }
    }

    function copyURL(button) {
      const input = button.previousElementSibling;
      input.select();
      document.execCommand("copy");
      button.innerText = "âœ… Copied!";
      setTimeout(() => (button.innerText = "ðŸ“‹ Copy URL"), 1500);
    }

    document.addEventListener("DOMContentLoaded", loadMedia);
  </script>
</body>
</html>
